import React, { useState, useEffect } from 'react';
import { 
  BookOpen, 
  Sparkles, 
  Languages, 
  ChevronRight, 
  Copy, 
  RefreshCw, 
  Heart, 
  Moon, 
  Sun, 
  Compass, 
  ShieldCheck,
  ArrowLeft,
  Share2,
  Loader2
} from 'lucide-react';

/**
 * WUGUMA AI - TEOLOGI KONTEKSTUAL PAPUA
 * Arsitektur: React Single-File (Vite-Ready)
 * Tema: Earthy, Sacred, Tranquil
 */

// --- DATA: MOCK MONI BIBLE DATA ---
const MONI_BIBLE_SNIPPETS = [
  { ref: "Yohanes 3:16", moni: "Aguwa mbe hauge me, me hauge me mbai, me hauge me mbai nggia...", indo: "Karena begitu besar kasih Allah akan dunia ini..." },
  { ref: "Mazmur 23:1", moni: "Tuhan nggia naga nggatua, naga nggambani nggia...", indo: "Tuhan adalah gembalaku, takkan kekurangan aku..." }
];

// --- UTILS: AI SERVICE (SIMULATED) ---
const generateDevotionAI = async (topic, lang) => {
  // Simulasi delay network
  await new Promise(resolve => setTimeout(resolve, 2000));
  
  const isMoni = lang === 'moni';
  
  // Mock Response Logic
  return {
    judul: isMoni ? `Wuguma: ${topic} (Hau Me)` : `Renungan: ${topic}`,
    ayatUtama: isMoni ? "Yohanes 3:16 (Moni Contextual)" : "Yohanes 3:16",
    isiRenungan: `Tuhan memanggil kita untuk berjalan dalam ${topic}. Di tanah Papua, seperti pegunungan yang kokoh, iman kita harus berakar kuat pada Kristus. Wuguma (berjalan bersama) adalah kunci kemenangan iman kita hari ini.`,
    isiRenunganIndo: isMoni ? "Tuhan memanggil kita untuk hidup dalam kasih. Seperti persaudaraan di honai, kasih Kristus menyatukan perbedaan dan memberikan kekuatan baru." : null,
    wugumaMoment: {
      pesanTuhan: "Jangan takut, Aku menyertai setiap langkahmu di lembah maupun gunung.",
      arahLangkah: "Mulailah hari dengan mengucap syukur dalam bahasa hati.",
      sikapHati: "Rendah hati seperti hamba yang setia."
    },
    doa: "Tuhan Yesus, terima kasih atas firman-Mu. Berkati langkah kami hari ini. Haleluya, Amin.",
    ayatPegangan: "Filipi 4:13"
  };
};

// --- COMPONENTS ---

const Header = ({ darkMode, setDarkMode, setPage }) => (
  <header className={`sticky top-0 z-40 backdrop-blur-md border-b ${darkMode ? 'bg-slate-900/80 border-slate-800' : 'bg-white/80 border-emerald-100'} transition-colors duration-300`}>
    <div className="max-w-4xl mx-auto px-6 h-16 flex items-center justify-between">
      <div className="flex items-center gap-2 cursor-pointer" onClick={() => setPage('home')}>
        <div className="bg-emerald-600 p-1.5 rounded-lg">
          <BookOpen className="text-white w-5 h-5" />
        </div>
        <h1 className="font-serif font-bold text-xl tracking-tight bg-gradient-to-r from-emerald-600 to-teal-500 bg-clip-text text-transparent">
          WUGUMA AI
        </h1>
      </div>
      <div className="flex items-center gap-4">
        <button 
          onClick={() => setDarkMode(!darkMode)}
          className={`p-2 rounded-full transition-colors ${darkMode ? 'hover:bg-slate-800 text-yellow-400' : 'hover:bg-emerald-50 text-emerald-700'}`}
        >
          {darkMode ? <Sun size={20} /> : <Moon size={20} />}
        </button>
      </div>
    </div>
  </header>
);

const Footer = ({ darkMode }) => (
  <footer className={`py-12 px-6 border-t ${darkMode ? 'bg-slate-950 border-slate-900 text-slate-500' : 'bg-emerald-50/50 border-emerald-100 text-emerald-700/60'}`}>
    <div className="max-w-4xl mx-auto text-center space-y-4">
      <p className="font-serif italic">"Wuguma: Berjalan Bersama Kristus di Tanah Papua"</p>
      <div className="text-xs uppercase tracking-widest">© 2024 Wuguma AI Project • Teologi Kontekstual</div>
    </div>
  </footer>
);

// --- MAIN PAGES ---

const HomePage = ({ onStart, darkMode }) => (
  <div className="animate-in fade-in duration-700">
    <section className="relative py-20 px-6 overflow-hidden">
      <div className={`absolute top-0 left-1/2 -translate-x-1/2 w-full h-full -z-10 opacity-10 ${darkMode ? 'invert' : ''}`}>
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-emerald-200 via-transparent to-transparent"></div>
      </div>
      
      <div className="max-w-3xl mx-auto text-center space-y-8">
        <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-100 text-emerald-800 text-sm font-medium mb-4">
          <Sparkles size={14} />
          <span>Renungan Berbasis Kecerdasan Buatan</span>
        </div>
        <h2 className={`text-4xl md:text-6xl font-serif font-bold leading-tight ${darkMode ? 'text-white' : 'text-slate-900'}`}>
          Mendengar Suara Tuhan dalam <span className="text-emerald-600 underline decoration-emerald-200 underline-offset-8">Bahasa Hati</span>.
        </h2>
        <p className={`text-lg max-w-2xl mx-auto leading-relaxed ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>
          Wuguma AI menghadirkan firman Tuhan melalui perpaduan teologi modern dan kekayaan bahasa Moni. Temukan kedamaian di setiap pergumulan Anda.
        </p>
        <div className="pt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
          <button 
            onClick={onStart}
            className="w-full sm:w-auto px-10 py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-semibold text-lg shadow-xl shadow-emerald-600/20 transition-all hover:scale-105 active:scale-95 flex items-center justify-center gap-2"
          >
            Mulai Renungan <ChevronRight size={20} />
          </button>
        </div>
      </div>
    </section>

    <section className="max-w-5xl mx-auto px-6 py-20 grid md:grid-cols-3 gap-8">
      {[
        { icon: <Languages className="text-blue-500" />, title: "Kontekstual", desc: "Bahasa Moni (Papua) yang diintegrasikan secara mendalam." },
        { icon: <Compass className="text-orange-500" />, title: "Amanah", desc: "Berbasis Alkitabiah dengan kurasi teologi yang sehat." },
        { icon: <ShieldCheck className="text-emerald-500" />, title: "Privasi", desc: "Pergumulan Anda adalah ruang rahasia antara Anda dan Tuhan." }
      ].map((feature, i) => (
        <div key={i} className={`p-8 rounded-3xl border ${darkMode ? 'bg-slate-900/50 border-slate-800' : 'bg-white border-emerald-50'} transition-all hover:shadow-lg`}>
          <div className="mb-4">{feature.icon}</div>
          <h3 className={`text-xl font-bold mb-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>{feature.title}</h3>
          <p className={darkMode ? 'text-slate-400' : 'text-slate-600'}>{feature.desc}</p>
        </div>
      ))}
    </section>
  </div>
);

const GeneratorPage = ({ onGenerate, darkMode }) => {
  const [topic, setTopic] = useState('');
  const [lang, setLang] = useState('id');
  const suggestions = ['Kasih', 'Firman', 'Hikmat', 'Kekuatan Iman', 'Maranata', 'Kesembuhan'];

  return (
    <div className="max-w-2xl mx-auto px-6 py-12 animate-in slide-in-from-bottom-4 duration-500">
      <div className="space-y-10">
        <div>
          <h3 className={`text-2xl font-serif font-bold mb-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>Siapkan Hati</h3>
          <p className={darkMode ? 'text-slate-400' : 'text-slate-600'}>Apa yang sedang menjadi pergumulan atau kerinduan hati Anda saat ini?</p>
        </div>

        <div className="space-y-4">
          <label className={`block text-sm font-semibold uppercase tracking-wider ${darkMode ? 'text-slate-500' : 'text-emerald-800'}`}>Pilih Bahasa Renungan</label>
          <div className="grid grid-cols-2 gap-4">
            {[
              { id: 'id', label: 'Indonesia' },
              { id: 'moni', label: 'Moni (Papua)' }
            ].map((l) => (
              <button
                key={l.id}
                onClick={() => setLang(l.id)}
                className={`p-4 rounded-2xl border-2 transition-all flex items-center justify-center gap-2 ${
                  lang === l.id 
                    ? 'border-emerald-600 bg-emerald-50 text-emerald-700' 
                    : darkMode ? 'border-slate-800 bg-slate-900 text-slate-400' : 'border-slate-100 bg-white text-slate-500'
                }`}
              >
                <Languages size={18} />
                {l.label}
              </button>
            ))}
          </div>
        </div>

        <div className="space-y-4">
          <label className={`block text-sm font-semibold uppercase tracking-wider ${darkMode ? 'text-slate-500' : 'text-emerald-800'}`}>Pergumulan Anda</label>
          <textarea
            value={topic}
            onChange={(e) => setTopic(e.target.value)}
            placeholder="Contoh: Saya butuh kekuatan dalam menghadapi pekerjaan..."
            className={`w-full p-6 rounded-3xl min-h-[150px] transition-all outline-none border-2 ${
              darkMode 
                ? 'bg-slate-900 border-slate-800 text-white focus:border-emerald-700' 
                : 'bg-white border-emerald-50 text-slate-800 focus:border-emerald-300 shadow-sm'
            }`}
          />
        </div>

        <div className="space-y-4">
          <p className={`text-sm font-medium ${darkMode ? 'text-slate-500' : 'text-slate-500'}`}>Topik Cepat:</p>
          <div className="flex flex-wrap gap-2">
            {suggestions.map((s) => (
              <button
                key={s}
                onClick={() => setTopic(s)}
                className={`px-4 py-2 rounded-full text-sm transition-all ${
                  topic === s 
                  ? 'bg-emerald-600 text-white' 
                  : darkMode ? 'bg-slate-800 text-slate-400 hover:bg-slate-700' : 'bg-emerald-50 text-emerald-700 hover:bg-emerald-100'
                }`}
              >
                {s}
              </button>
            ))}
          </div>
        </div>

        <button
          disabled={!topic}
          onClick={() => onGenerate(topic, lang)}
          className="w-full py-5 bg-emerald-600 hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-3xl font-bold text-lg shadow-xl shadow-emerald-600/20 transition-all flex items-center justify-center gap-3"
        >
          <Sparkles size={20} />
          Hasilkan Renungan
        </button>
      </div>
    </div>
  );
};

const OutputPage = ({ data, onReset, darkMode }) => {
  const [copied, setCopied] = useState(false);

  const handleCopy = () => {
    const text = `${data.judul}\n\n${data.ayatUtama}\n\n${data.isiRenungan}\n\nDoa: ${data.doa}`;
    document.execCommand('copy'); // Fallback for environments
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <div className="max-w-3xl mx-auto px-6 py-12 animate-in zoom-in-95 duration-500">
      <button 
        onClick={onReset}
        className={`mb-8 flex items-center gap-2 text-sm font-medium ${darkMode ? 'text-slate-400' : 'text-slate-600 hover:text-emerald-700 transition-colors'}`}
      >
        <ArrowLeft size={16} /> Kembali
      </button>

      <div className={`rounded-[2.5rem] overflow-hidden border shadow-2xl ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-emerald-50'}`}>
        <div className="bg-emerald-600 p-8 text-white text-center">
          <Heart className="mx-auto mb-4 opacity-80" fill="currentColor" size={32} />
          <h2 className="text-3xl font-serif font-bold mb-2">{data.judul}</h2>
          <div className="inline-block px-4 py-1 bg-emerald-500/50 rounded-full text-sm backdrop-blur-sm">
            {data.ayatUtama}
          </div>
        </div>

        <div className="p-8 md:p-12 space-y-10">
          <div className="prose prose-lg max-w-none">
            <p className={`leading-relaxed text-lg italic ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>
              {data.isiRenungan}
            </p>
            {data.isiRenunganIndo && (
              <div className={`mt-6 p-4 rounded-2xl border-l-4 border-emerald-500 ${darkMode ? 'bg-slate-800/50' : 'bg-emerald-50/50'}`}>
                <p className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>
                  <strong>Terjemahan Indonesia:</strong><br/>
                  {data.isiRenunganIndo}
                </p>
              </div>
            )}
          </div>

          <div className="grid md:grid-cols-3 gap-6">
            <div className={`p-6 rounded-3xl ${darkMode ? 'bg-slate-800/40' : 'bg-orange-50/50'}`}>
              <h4 className="font-bold text-orange-600 text-sm mb-2 uppercase tracking-wide">Pesan Tuhan</h4>
              <p className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-700'}`}>{data.wugumaMoment.pesanTuhan}</p>
            </div>
            <div className={`p-6 rounded-3xl ${darkMode ? 'bg-slate-800/40' : 'bg-blue-50/50'}`}>
              <h4 className="font-bold text-blue-600 text-sm mb-2 uppercase tracking-wide">Arah Langkah</h4>
              <p className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-700'}`}>{data.wugumaMoment.arahLangkah}</p>
            </div>
            <div className={`p-6 rounded-3xl ${darkMode ? 'bg-slate-800/40' : 'bg-emerald-50/50'}`}>
              <h4 className="font-bold text-emerald-600 text-sm mb-2 uppercase tracking-wide">Sikap Hati</h4>
              <p className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-700'}`}>{data.wugumaMoment.sikapHati}</p>
            </div>
          </div>

          <div className={`p-8 rounded-3xl border-2 border-dashed ${darkMode ? 'border-slate-800' : 'border-emerald-100'}`}>
            <h4 className={`text-center font-bold mb-4 ${darkMode ? 'text-white' : 'text-slate-800'}`}>Doa Penutup</h4>
            <p className={`text-center italic leading-relaxed ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>
              "{data.doa}"
            </p>
          </div>

          <div className="flex flex-col sm:flex-row gap-4 pt-4 border-t border-slate-100">
            <button 
              onClick={handleCopy}
              className={`flex-1 flex items-center justify-center gap-2 py-4 rounded-2xl font-semibold transition-all ${
                copied 
                ? 'bg-emerald-100 text-emerald-700' 
                : darkMode ? 'bg-slate-800 text-white hover:bg-slate-700' : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
              }`}
            >
              {copied ? <ShieldCheck size={18} /> : <Copy size={18} />}
              {copied ? 'Tersalin!' : 'Salin Renungan'}
            </button>
            <button 
              onClick={onReset}
              className="flex-1 flex items-center justify-center gap-2 py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-semibold transition-all shadow-lg shadow-emerald-600/20"
            >
              <RefreshCw size={18} /> Renungan Baru
            </button>
          </div>
        </div>
      </div>
      
      <div className="mt-8 text-center">
        <p className={`text-sm font-medium ${darkMode ? 'text-slate-500' : 'text-slate-500'}`}>Ayat Pegangan Hari Ini: <span className="text-emerald-600">{data.ayatPegangan}</span></p>
      </div>
    </div>
  );
};

// --- MAIN APP COMPONENT ---

export default function App() {
  const [page, setPage] = useState('home'); // home, generator, output
  const [loading, setLoading] = useState(false);
  const [darkMode, setDarkMode] = useState(false);
  const [devotionResult, setDevotionResult] = useState(null);

  const handleStart = () => {
    window.scrollTo(0,0);
    setPage('generator');
  };

  const handleGenerate = async (topic, lang) => {
    setLoading(true);
    try {
      const result = await generateDevotionAI(topic, lang);
      setDevotionResult(result);
      setPage('output');
    } catch (err) {
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  // State Persistence for Theme
  useEffect(() => {
    if (darkMode) {
      document.body.classList.add('bg-slate-950');
      document.body.classList.remove('bg-white');
    } else {
      document.body.classList.add('bg-white');
      document.body.classList.remove('bg-slate-950');
    }
  }, [darkMode]);

  return (
    <div className={`min-h-screen font-sans transition-colors duration-500 ${darkMode ? 'text-slate-200' : 'text-slate-800'}`}>
      
      {/* Loading Overlay */}
      {loading && (
        <div className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-emerald-950/90 backdrop-blur-sm text-white p-6 text-center">
          <Loader2 className="w-12 h-12 text-emerald-400 animate-spin mb-6" />
          <h3 className="text-2xl font-serif font-bold mb-2">Wuguma AI sedang merenung...</h3>
          <p className="text-emerald-200/70 max-w-xs">Menyelaraskan hikmat firman Tuhan untuk langkah Anda hari ini.</p>
        </div>
      )}

      <Header darkMode={darkMode} setDarkMode={setDarkMode} setPage={setPage} />

      <main className="min-h-[calc(100vh-160px)]">
        {page === 'home' && <HomePage onStart={handleStart} darkMode={darkMode} />}
        {page === 'generator' && <GeneratorPage onGenerate={handleGenerate} darkMode={darkMode} />}
        {page === 'output' && devotionResult && (
          <OutputPage 
            data={devotionResult} 
            onReset={() => setPage('generator')} 
            darkMode={darkMode} 
          />
        )}
      </main>

      <Footer darkMode={darkMode} />

      {/* Sacred Texture Overlay */}
      <div className="fixed inset-0 pointer-events-none opacity-[0.03] mix-blend-overlay">
        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
          <filter id="noise">
            <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch" />
          </filter>
          <rect width="100%" height="100%" filter="url(#noise)" />
        </svg>
      </div>
    </div>
  );
}

// Styling note: Tailwind is used throughout for consistent layout and theming.

